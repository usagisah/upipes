#  upipes

具体来说，`upipes` 是一个用来组织和协调多个函数之间，应该以一种怎样的方式执行的管理器（或者叫协调器）

PS：如果不懂 `rxjs` 可以跳过文档中先关的内容，并不影响阅读和使用





## 给我一个使用的理由

判断是否需要用 `upipes` 的理由非常简单，当遇到一个函数搞不定的问题时，可以尝试思考以下问题，如果个别不想自己从头实现，就可以

- 允许中断 —— 例如请求中，如果接口报错，可以在封装中就做处理，不用在业务代码中混杂 `catch` 语句
- 条件重试 —— 例如请求中，如果接口报错可以自动重试
- 固定转换 —— 例如 `websocket `和 点击事件，触发后可能会需要做限流，组合，丢弃，转换等固定操作
- 订阅多播 —— 例如点击事件，在满足保留上述所有能力的基础上，做到一处订阅的同时，使用多个订阅函数

- 打包友好 —— `upipes` 的文件导出对于 `treeshaking` 是友好的，实际打包中只会包含需要的部分



`upipes` 擅长于简化转换操作，能够将冗长的函数拆分成一个个由**普通单一职责的纯函数**组成的链式结构，在这点上和 `Promise` 的 `.then` 很是相像

但是 `Promise` 仅仅是个状态机，一旦状态发生改变就不在会产生新的变化，而 `upipes` 可以扩展这个链路，让其变成可重复执行，支持 `Promise`，可中断，可重试，还不会发生内存泄漏





## 功能分类

功能上可以分为以下 **4 类**

1. `createPipes` 这是所有功能基石，它提供了所有的基础能力（如果功能没有明确指明，都默认包含在内），可以单独拿出来使用，其他所有功能都是基于它的封装
2. `observable` 观察者系列，提供了，惰性执行、一次订阅多处执行，相关的扩展能力
3. `operators` 操作符系列，提供了，常用的转换工具，如报错重试，成功和异常间的状态转换，过滤，组合，并发，等
4. `builder` 创造者系列，提供了基于 `observable` 系列的二次封装，用于基于一般内容快速的创建





## 和 `rxjs` 的关系

实际上 `upipes` 就是脱胎于 `rxjs`，是 `rxjs` 的简化版，之所以另起炉灶是因为，在实际使用过程中，`rxjs` 通常无法很好的用起来，总结原因如下

- 缺乏和官方与时俱进的中文文档
- 无法直接拿来用，需要进行一定量的封装
- 概念多，上手难度大，自己在喜欢同事们基本都不会喜欢，因为不想花时间去学一个很**麻烦**的东西



由使用 `rxjs`到产生做 `upipes` 的原因

- 文档
  - 翻译不来，本人英文水平还不到能准确翻译的程度
  - 项目中只能用在解决疑难杂症和有需要的地方上，无法面积铺开来用，因为同样的功能不是只有自己维护
  - 使用 `rxjs` 可以减少很多管理的代码，可对于不想学的同事来说，他们会用他们的方式搞出新功能，由此产生技术栈的撕裂，导致的代码变屎
- 概念多，上手难度大
  - 概念其实不用理解太透彻，用上后根据使用反推，可实际上天天写代码的，没多少人喜欢尝试新事物
  - 想要用好，需要了解和尝试更多的操作符，这会直接劝退很多人
- 封装，框架中，`rxjs` 通常是无法直接用的，需要进行大量的封装操作
  - 写法上非常的死板，为了降低用的人的难度（用户很大可能不懂操作符），经常需要把各种东西转来转去的，这些明显是多余的
  - `rxjs` 同时适用于处理，单条异步流（高频），也适用于多条异步流（很少很少会用到），可是操作符太多了
    - 工作中能用到往往是冰山一角，对于一个功能会有若干个细分的操作符
    - 冗余的太多太多，因为找起来麻烦，实际只会用比较熟悉的几个，其实可能会有更加适用的
  - 代码复杂度
    - 能干的事情其实可以更多，但前端用于都不喜欢 `java` 式的那么多冗余代码，所以实际封装下来，简单的事会变得很复杂
    - `rxjs` 内部实现的复杂度，对于简单如点击事件之类，其实可以更简单，更简洁



在实现上，最高的复杂度上感觉相差无几了，所以根据功能做了细分，可以根据情况选择相对更加简洁好用的

相比之下的 `upipes`，提供了更多的语法糖，提取了实用的功能，更加注重于单条异步流

- 概念友好

  - 知不知道其实无所谓，因为上手足够简单
- 操作符友好

  - 数量较少，保留实用的
  - 自定义简单，随便丢个函数进去就是一个操作符
- 封装友好
  - 这类东西都是工具，使其作为底层进行二次封装是不可避免的
  - 提供除了 `subscribe` 订阅之外，更多的取值方式
  - 各种东西加起来能减少很多很多，封装时冗余的转换操作
  







## 不足

目前对于 `ts` 下能用，但是提示能用，但不太好

对于多条异步流的处理能力有限

