# 创造的原因和理念

这篇会讲解一些相关的概念，以及我为什么会执着于类似于 `rxjs` 这样异步流相关库的原因





## 业务开发中的反思

抛开业余时间做的诸多东西，工作中的我做的内容非常的垂直，重复性的东西做多了，花花心思也就渐渐都冒出来了

在这些年的前端开发工作中，干的最多最复杂的业务场景全都发生在后台管理系统，这些复杂度一半是遇到了很是抽象的产品，另一半则是自找的。尤其是前期，我总是在想，我到底要怎么做才能提高我的代码质量，怎么做才能提高我的技术

无论是`B`端还是`E`的系统，无论复杂的还是简单，它们的尿性归根结底都是重在管理各种数据，人的数据，商品的数据呀等等，为了保证数据的安全和操作的便捷，又能衍生出些其他的功能。如果把它们和前端的代码进行匹配，大致能得出以下关系

- 数据
  - 操作会围绕，增删改查，四类展开
  - 涉及到的高频种类有，表单，表格，弹窗
- 安全
  - 为了保障数据的安全而存在
  - 操作会围绕，权限，展开
  - 涉及到的操作有，权限管理（等级，种类，颗粒度）、框架集成，来展开
- 便捷
  - 便捷的范围是非常宽泛的，用户操作便捷、开发便捷、功能便捷等等

聊这个是想表达，基本的管理系统并不复杂，其他任何创新性不强的多半也是如此，真正难的是如何做好一个系统

在条件允许的情况下，我个人对于代码的复杂度上会稍稍敏感些。因为我创造过屎山，维护过屎山，也尽力铲过屎山，为了避免变成屎山，会另我会产生很多的思考和尝试。其结论就是一个字，拆

因为很多原因导致的复杂度，它们不会消失，最好的做法我能想到的最优解只能是，拆分后再进行转移

对于视图，可以拆组件；对于逻辑，可以通过自定义`hooks`拆代码；对于系统，可以通过微前端拆项目；配置多了，可以搞配置中心；重复性多了，可以依赖中台之类的东西

对于很多问题我们都会有相应的拆分手段，它们的特点是，拆的对象颗粒度都比较大，反之如果颗粒度越小，则拆的越加困难，毕竟拆好组件可比拆好不同的`hooks`要简单的多

而我想要的则是用来构建函数的拆分方案，或者说用来构建一个函数就能承载的单一任务的拆分方案



## 为什么写好一个函数也会变得困难

写代码时我多少有点封装癖在，所以每次写完后都会想有没有更好的封装方法，因为不同的功能封装后，在组合各种小玩意会有种莫名其妙的满足感（自己也不是很懂为什么），同时拆的好会大大降低后期的维护难度

可实际上有很多即便不复杂的应用，在写的初期会考虑不完全，先是靠着感觉写成几团，写完后再做重构细分，这样的返工在我写代码时是频繁发生的事情。于是经过思考和观察，我发现了这样的现象

简单的函数多了用起来需要到处找只会觉得烦。而复杂的函数之所以复杂是因为做的事情太多了，这些事情之间的强关联性越强，对于优化这种代码的人个人代码水平要求就越高

也许会有这样的疑问，对于强耦合的代码为什么一定非拆不可呢。我并不是为了拆而拆，所做的所有事情都只有一个目的，就是降低或者均摊复杂度，我可以接受因为拆的琐碎让维护变得很耗时，但我不太能接受代码复杂到维护时需要举步维艰



## 拆分的规则

在接触到 `rxjs` 时我第一时间没有觉得这东西好用，我觉得它很难用，概念多，方法多。网上到处搜索相关的文章，搜到的要不是吹捧的，要不是就是廉价的教学文章，实战相关的很少很少，重复的居多，有帮助的少之又少，几乎没有

事情的转机发生在我想要写个类似于`vue/react`的框架时发生的事。如果以框架作者的角度思考问题，其实可以刚好对应的`rxjs`的实际用法中去（此时的我已经放弃去理解和记忆它的概念和名词了，但这并不影响我用它）

使用 `rxjs` 的过程可以分为三步，创建数据源，定义数据转换的中间过程，消费最终值。这就像我们用`vue/react`时，第一步要定义框架的响应式状态，第二步会在生命周期或者事件中用数据做些自己的事情，第三步改变数据让框架消费数据用于同步视图。这个过程可以非常复杂，也可以非常简单，复杂在不知道用户会干什么，简单在改变响应式状态的规则是确定的。即创建入口和最终消费的出口是确定的，是收束的。而 `rxjs` 让中间的转换变成了线性，同时还不会丢失函数组合的灵活，毕竟对于超级复杂的异步流处理是人家的卖点

如果把它和函数对象，入口是函数的调用，出口是函数的返回，转换是函数体，函数体可以被线性的分成不同的管道节点。所以 `rxjs` 的使用模式是我的理想结果

PS：`rxjs` 并不是像我想的这么用的，但是歪打正着戳到了我内心的点



## `rxjs` 的补足

它最大的不足是不够好用，这个不好用会体现在各个方面，因为这东西上手难，学的多，概念多，方法多，组合多，用好难，忘得快，封装不友好，实现复杂度也不友好

当然，如果按照人家的创造理念来说很多东西都是没问题的，说这么多都是因为它不满足我想要的，导致我在鸡蛋里挑骨头罢了。可结果是我想要个类似的东西，我有试过强行封装成我想要的形状，可强扭的瓜不甜，我只得重造

做 `upipes` 的理念就是为了满足我，想要有一个通用的方式来拆分一个大函数的渴望。它需要像函数一样用起来简单，观念少只看demo就能好上手，满足线性执行，好维护，好定位问题，便于增删改查功能，最好要提供流式的控制能力。尤其在封装接口时我会想，如果可以在报错时，在封装的函数内就直接处理，尽量不要抛出异常到使用的业务代码里

为了做到这些，便模仿着`rxjs` 的样子做了出来，并且提供了便于封装的一些特性，为了更好的控制和使用提供了为数不多的操作符



